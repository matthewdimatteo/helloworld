pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- top-down series
-- example 05: warping
-- by matthew dimatteo

-- tab 0: game loop
-- tab 1: player functions
-- tab 2: camera function
-- tab 3: warp function

-- runs once at start
function _init()

	solid = 0 -- sprite flag
	make_plyr() -- tab 1

	-- target tile coordinates
	tx = plyr.x
	ty = plyr.y

end -- end _init()

-- loops 30x/sec
function _update()
	move_plyr() -- tab 1
	warp() -- tab 3
end -- end _update()

-- loops 30x/sec
function _draw()
	cls() -- clear screen
	map() -- draw map at 0,0
	set_camera() -- tab 2
	
	-- draw player
	spr(plyr.n,plyr.x*8,plyr.y*8,1,1,plyr.flip)

	-- print coordinates	
	print(plyr.x..","..plyr.y,camx+2,camy+2,7)
	
end -- end _draw()
-->8
-- player functions
function make_plyr()
	plyr = {} -- player object
	plyr.n=64
	
	-- x,y tile coords
	plyr.x=23
	plyr.y=9
	
	plyr.flip=false
	plyr.facing="down"
end -- end make_plyr()

function move_plyr()

	-- left
	if btnp(⬅️) then
		tx = plyr.x - 1
		ty = plyr.y
		plyr.dir = "left"
		plyr.n = 66
		plyr.flip = true
	end -- end if btnp(⬅️)
	
	-- right
	if btnp(➡️) then
		tx = plyr.x + 1
		ty = plyr.y
		plyr.dir = "right"
		plyr.n = 66
		plyr.flip = false
	end -- end if btnp(➡️)
	
	-- up
	if btnp(⬆️) then
		ty = plyr.y - 1
		tx = plyr.x
		plyr.dir = "up"
		plyr.n = 65
		plyr.flip = false
	end -- end if btnp(⬆️)
	
	-- down
	if btnp(⬇️) then
		ty = plyr.y + 1
		tx = plyr.x
		plyr.dir = "down"
		plyr.n = 64
		plyr.flip = false
	end -- end if btnp(⬇️)
	
	-- sprite number of target tile
	tn = mget(tx,ty)
 
	-- true/false is flag 0 on
	-- for that sprite
	is_solid = fget(tn,solid)
 
	-- move to target if not solid
	if is_solid == false then
		plyr.x=tx
		plyr.y=ty
	end -- end if is_solid == false
	
	-- constrain player to map
	if plyr.x < 0 then
		plyr.x = 0
	end
	if plyr.y < 0 then
		plyr.y = 0
	end
	if plyr.x > 127 then
		plyr.x = 127
	end 
	if plyr.y > 63 then
		plyr.y = 63
	end
	
end -- end move_plyr()
-->8
-- camera
function set_camera()

	-- determine top-left screen
	-- coordinates (in pixels)
	-- based on player's x,y coords

	-- each tile is 8x8 pixels
	tilesize=8 
	
	-- each screen is 16 tiles
	screensize=16 
	
	-- calculate how many screens
	-- to the right of the origin
	-- (0,0) the player is
	screenx=flr(plyr.x/screensize) 

	-- calculate how many screens
	-- below the origin (0,0) the
	-- player is
	screeny=flr(plyr.y/screensize) 

	-- multiply the camera coords 
	-- by the number of pixels per
	-- tile to convert the player's
	-- tile coords to a pixel value
	camx = screenx * tilesize 
	camy = screeny * tilesize 

	-- multiply the camera coords 
	-- by the number of tiles per
	-- screen to position it at the
	-- origin of the current screen
	-- (set of 16 tiles)
	camx*=screensize
	camy*=screensize
	
	-- position the camera
	camera(camx,camy)
	 
end -- end set_camera
-->8
-- dungeon warp
function warp()

	-- dungeon entrance tile coords
	-- these coords align with the
	-- door into the dungeon from
	-- the outside
	entx=23
	enty=7

	-- dungeon exit tile coords
	-- these coords align with the
	-- tile inside the dungeon that
	-- takes the plyr back outside
	exitx=88
	exity=31

	-- warp into dungeon
	if  plyr.x == entx
	and plyr.y == enty then
		plyr.x=exitx
		plyr.y=exity-1 -- ofset 1 tile
		set_camera()
	end -- end if entx/y
	
	-- warp out of dungeon
	if  plyr.x == exitx
	and plyr.y == exity then
		plyr.x=entx
		plyr.y=enty+1 -- offset 1 tile
		set_camera()
	end -- end if exitx/y

end -- end function warp()
__gfx__
00000000333333333333333333555533333bb333333bb33300000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000033333333333333333555555333bbbb3333bbbb3300000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700333333333be33333555555553bb8bbb33bbbbbb300000000000000000000000000000000000000000000000000000000000000000000000000000000
000770003333333333b3333355555555bbbbb8bbbbbbbbbb00000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700033333333333333eb555555553b8bbbb33bbbbbb300000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070033333333333b33b35555555533bbbb3333bbbb3300000000000000000000000000000000000000000000000000000000000000000000000000000000
000000003333333333eb333335555553333443333334433300000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000333333333333333333555533333443333334433300000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111111111111111555511111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
00000000111111111111111115555551111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
000000001111111111cc1111555555551111ccc111c1c1c111bbbb11111111110000000000000000000000000000000000000000000000000000000000000000
000000001111111111111111555555551ccc11111c1c1c1111beeb11111111110000000000000000000000000000000000000000000000000000000000000000
00000000111111111111111155555555111111111111111111beeb11111111110000000000000000000000000000000000000000000000000000000000000000
00000000111111111cc1cc11555555551111ccc111c1c1c111bbbb11111111110000000000000000000000000000000000000000000000000000000000000000
000000001111111111111111155555511ccc11111c1c1c1111111111111111110000000000000000000000000000000000000000000000000000000000000000
00000000111111111111111111555511111111111111111111111111111111110000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666665665665555555556666666600000000000000006666666655555555555555550000000000000000000000000000000000000000
00000000666666666666666655555555500000056666666600000000000000006666666655666655556666550000000000000000000000000000000000000000
00000000666666666656666666566656500000056666666600000000000000009996666656566565566666650000000000000000000000000000000000000000
00000000666666666666656655555555500000056666666600000000000000009a99999956655665566666650000000000000000000000000000000000000000
0000000066666666666666665666566650000005333333330000000000000000969aa9a956600665566666650000000000000000000000000000000000000000
000000006666666666666666555555555000000533333333000000000000000099966a6a56566565566666650000000000000000000000000000000000000000
0000000066666666666656666656656650000005333333330000000000000000aaa6666656666665566666650000000000000000000000000000000000000000
00000000666666666666666655555555500000053333333300000000000000006666666656666665566666650000000000000000000000000000000000000000
00000000999999999999999999444499333333544444444445333333000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999994444449333335444544445444533333000000000000000000000000000000000000000000000000000000000000000000000000
000000009999999999a9999944444444333354444444444444453333000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999944444444333544544445444445445333000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999994944444444335444444444445444444533000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999944444444354454444544444444454453000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999699999994444449544444544444544444444445000000000000000000000000000000000000000000000000000000000000000000000000
00000000999999999999999999444499445444444444444445444544000000000000000000000000000000000000000000000000000000000000000000000000
00044000000440000004400000044000000440000004400000000000000000000000000000000000000000000000000000000000000000000000000000000000
00099000000440000009900000099000000990000009900000000000000000000000000000000000000000000000000000000000000000000000000000000000
00099000000990000009900000099000000990000009900000000000000000000000000000000000000000000000000000000000000000000000000000000000
08888880088888800008800000088000000880000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000
80888808808888080008880000088000000880000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000
00cccc0000cccc00000cc000000c80000008c000000c800000000000000000000000000000000000000000000000000000000000000000000000000000000000
00c00c0000c00c00000cc000000cc000000cc000000cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00c00c0000c00c00000cc000000cc000000cc000000cc00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
50505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050
32323232323232323232323232323232323232323232323212323232323232323232323232323232323232323232323232000000000000000000000000000000
__gff__
0000000103010000000000000000000000010101030502850000000000000000000000014080000004090000000000000000000101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
1717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717111111212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121111111111111111111111111111111
1717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717171717111111212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121212121111111111111111111111111111111
0504040404040404040404050505050505232323232323232323232323232305050101010101010101010101010101050501010101010101010101010101010105232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323000000000000000000000000000000
0501020101010201010101050501010405232323232323232323232323232305050101010101010101010101010101050501010101010101010101010101010105232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0501010102010101010201050101020505232323232323232323232323232305050101010101010101010101010101050501010101010101010101010101010105232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0505050505010101050505050105010505232323232323232323232323232305050101010101010101010101010101010101010101010101010101010101010105232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0505020101010101020101010105050505232323232323232323232323232305050101010101010101010101010101050501010101010101010101010101010105232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0505010101010101010101020101010405232323232323242323232323232305050101010101010101010101010101050501010101010101010101010101010105232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0504010102010101010501010101050505010101010101010101010101010105050101010101010101010101010101050501010101010101010101010101010105232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0505050105050505010505010101010505010101010101010101010101010105050101010101010101010101010101050501010101010101010101010101010105232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0505050105050505010505050101010105010101010101010101010101010105010101010101010101010101010101050501010101010101010101010101010105232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0505050105050504010505050501010505010101010101010101010101010105050101010101010101010101010101050501010101010101010101010101010105232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0505050105050505010505050405010505010101010101010101010101010105050101010101010101010101010101010101010101010101010101010101010105232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0505010101010505010105050105010505010101010101010101010101010105050101010101010101010101010101050501010101010101010101010101010105232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0504010101010101010101010101010505010101010101010101010101010105050101010101010101010101010101050501010101010101010101010101010105232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0505050505050505050501050505050505050505050505050505050505050505050101010101010101010101010101050501010101010101010101010101010123232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323000000000000000000000000000000
0505050505050505050501050505050505050505050505050505050505050505050101010101010101010101010101050501010101010101010101010101010123232323232323232323232323232323212121212121212121212121212121212323232323232323232323232323232323000000000000000000000000000000
1717171717171717171701171717171705050505050505050505050505050505171717171717011717171717171717171717171717170117171717171717171723232323232323232323232323232323212121212121212121212121212121212323232323232323232323232323232323000000000000000000000000000000
1717171717171717171701171717171717171717171717171717170117171717171717171717011717171717171717171717171717170117171717171717171723232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323000000000000000000000000000000
0501010101010101010101010101010101010101010101010101010101010105050101010101010101010101010101050501010101010101010101010101010123232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323232323000000000000000000000000000000
0501010101010101010101010101010101010101010101010101010101010105050101010101010101010101010101050501010101010101010101010101010123232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0501010101010101010101010101010101010101010101010101010101010105050101010101010101010101010101050501010101010101010101010101010123232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0501010101010101010101010101010101010101010101010101010101010105050101010101010101010101010101050501010101010101010101010101010123232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0501010101010101010101010101010101010101010101010101010101010105050101010101010101010101010101010101010101010101010101010101010123232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0501010101010101010101010101010101010101010101010101010101010105050101010101010101010101010101050501010101010101010101010101010123232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0501010101010101010101010101010101010101010101010101010101010105050101010101010101010101010101050501010101010101010101010101010123232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0505010101010101010101010101010101010101010101010101010101010105050101010101010101010101010101050501010101010101010101010101010123232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0505010101010101010101010101010101010101010101010101010101010105050101010101010101010101010101050501010101010101010101010101010123232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0505010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101050501010101010101010101010101010123232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0505010101010101010101010101010101010101010101010101010101010105050101010101010101010101010101050501010101010101010101010101010123232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0505010101010101010101010101010101010101010101010101010101010105050101010101010101010101010101050501010101010101010101010101010123232121212121212121212121212123232121212121212121212121212121232321212121212121212121212121212323000000000000000000000000000000
0505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050505050523232323232323232323232323232323232323232323232321232323232323232323232323232323232323232323232323000000000000000000000000000000
__sfx__
000400000c05000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000500002a05035050350500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00050000277502c750317503375037750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000003305038050340503505034050320500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00100000120500f0500b0500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
